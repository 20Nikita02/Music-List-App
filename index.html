<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>My Songs List</title>
  <style>
    :root { --bg:#0b0c10; --card:#12141a; --muted:#a9b0c0; --text:#eef1f7; --line:#222636; --btn:#1a1f2d; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background:var(--bg); color:var(--text); }
    .wrap { max-width: 980px; margin: 0 auto; padding: 14px; display:flex; flex-direction:column; gap:12px; }
    .top { display:flex; flex-direction:column; gap:10px; }
    .card { background:var(--card); border:1px solid var(--line); border-radius:14px; padding:12px; }
    h1 { font-size:18px; margin:0 0 4px 0; }
    .sub { color:var(--muted); font-size:13px; margin:0; }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    .row > * { flex:1 1 160px; }
    label { display:block; font-size:12px; color:var(--muted); margin-bottom:6px; }
    input, select, button {
      width:100%; padding:10px 10px; border-radius:12px; border:1px solid var(--line);
      background:#0f1118; color:var(--text); font-size:14px;
    }
    button { background:var(--btn); cursor:pointer; }
    button:hover { filter:brightness(1.08); }
    .btnRow { display:flex; gap:10px; flex-wrap:wrap; }
    .btnRow button { flex:1 1 160px; }
    .pillRow { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .pill { font-size:12px; color:var(--muted); border:1px solid var(--line); padding:6px 10px; border-radius:999px; }
    .list { display:flex; flex-direction:column; gap:10px; }
    .artistCard { background: #0f1118; border:1px solid var(--line); border-radius:14px; overflow:hidden; }
    .artistHead { padding:10px 12px; display:flex; justify-content:space-between; align-items:center; gap:10px; border-bottom:1px solid var(--line); }
    .artistTitle { display:flex; flex-direction:column; gap:2px; min-width:0; }
    .artistTitle strong { font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .artistTitle span { font-size:12px; color:var(--muted); }
    .songList { display:flex; flex-direction:column; }
    .songRow {
      display:flex; gap:10px; align-items:center; padding:10px 12px;
      border-top:1px solid rgba(255,255,255,0.04);
    }
    .songMain { min-width:0; flex:1; }
    .songTitle { font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .songMeta { display:flex; gap:8px; flex-wrap:wrap; margin-top:4px; }
    .tag { font-size:11px; color:var(--muted); border:1px solid var(--line); padding:3px 8px; border-radius:999px; }
    .actions { display:flex; gap:8px; }
    .iconBtn { width:auto; padding:8px 10px; border-radius:12px; }
    .on { border-color:#5b7cfa; }
    .danger { border-color:#a33; }
    .small { font-size:12px; color:var(--muted); }
    .footerHint { color:var(--muted); font-size:12px; line-height:1.35; }
    input[type="file"] { padding:8px; background:#0f1118; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card top">
      <h1>My Songs List</h1>
      <p class="sub">Verticaal scrollen • Artists A–Z • Songs A–Z • Export/Import JSON</p>

      <div class="row">
        <div>
          <label>Artist</label>
          <input id="artistInput" placeholder="Bijv. Radiohead" autocomplete="off" />
        </div>
        <div>
          <label>Song title</label>
          <input id="songInput" placeholder="Bijv. Karma Police" autocomplete="off" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>Mood</label>
          <select id="moodSelect"></select>
        </div>
        <div>
          <label>Genre</label>
          <select id="genreSelect"></select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Favorite</label>
          <select id="favSelect">
            <option value="none">None</option>
            <option value="fav">Favorite</option>
            <option value="xfav">Extra Favorite</option>
          </select>
        </div>
        <div>
          <label>&nbsp;</label>
          <button id="addBtn">Add song</button>
        </div>
      </div>

      <div class="card" style="padding:10px;">
        <div class="row">
          <div>
            <label>Search</label>
            <input id="searchInput" placeholder="Search artist or song…" />
          </div>
          <div>
            <label>Filter mood</label>
            <select id="filterMood"></select>
          </div>
        </div>
        <div class="row">
          <div>
            <label>Filter genre</label>
            <select id="filterGenre"></select>
          </div>
          <div>
            <label>Filter favorites</label>
            <select id="filterFav">
              <option value="all">All</option>
              <option value="fav">Favorite only</option>
              <option value="xfav">Extra Favorite only</option>
              <option value="any">Any favorite (fav + xfav)</option>
              <option value="none">No favorite</option>
            </select>
          </div>
        </div>
      </div>

      <div class="pillRow">
        <span class="pill" id="statArtists">Artists: 0</span>
        <span class="pill" id="statSongs">Songs: 0</span>
        <span class="pill small">Tip: gebruik “Artist – Song” structuur, dan blijft alles super netjes.</span>
      </div>

      <div class="btnRow">
        <button id="exportBtn">Export (download JSON)</button>
        <button id="importBtn">Import (upload JSON)</button>
        <input id="fileInput" type="file" accept="application/json" style="display:none;" />
        <button id="clearBtn" class="danger">Clear all (local)</button>
      </div>

      <p class="footerHint">
        Data wordt lokaal opgeslagen in je browser via <b>localStorage</b>.
        Op een ander device importeer je je JSON exportbestand.
      </p>
    </div>

    <div class="list" id="list"></div>
  </div>

<script>
  // ---------- Config ----------
  const MOODS = ["Any", "Happy", "Sad", "Energetic", "Calm", "Instrumental", "Chill", "Focus", "Angry", "Romantic"];
  const GENRES = ["Any", "Pop", "Rock", "Hip-Hop", "R&B", "Electronic", "Dance", "Indie", "Metal", "Jazz", "Classical", "Soundtrack", "Folk", "Reggae", "Other"];

  // ---------- Storage ----------
  const STORAGE_KEY = "mySongsDB_v1";

  function loadDB() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return { songs: [] };
      const parsed = JSON.parse(raw);
      if (!parsed || !Array.isArray(parsed.songs)) return { songs: [] };
      return parsed;
    } catch {
      return { songs: [] };
    }
  }
  function saveDB(db) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(db));
  }

  // ---------- Helpers ----------
  const uid = () => Math.random().toString(16).slice(2) + Date.now().toString(16);
  const norm = (s) => (s || "").trim();
  const cmpAZ = (a,b) => a.localeCompare(b, undefined, { sensitivity:"base" });

  function buildSelect(selectEl, values, includeAll=false) {
    selectEl.innerHTML = "";
    if (includeAll) {
      const o = document.createElement("option");
      o.value = "all"; o.textContent = "All";
      selectEl.appendChild(o);
    }
    values.forEach(v => {
      const o = document.createElement("option");
      o.value = v;
      o.textContent = v;
      selectEl.appendChild(o);
    });
  }

  function sortDBSongs(songs) {
    // Sort by Artist A-Z, then Song Title A-Z
    return [...songs].sort((x,y) => {
      const a = cmpAZ(x.artist, y.artist);
      if (a !== 0) return a;
      return cmpAZ(x.title, y.title);
    });
  }

  function getFilteredSongs(allSongs) {
    const q = norm(searchInput.value).toLowerCase();
    const m = filterMood.value;
    const g = filterGenre.value;
    const f = filterFav.value;

    return sortDBSongs(allSongs).filter(s => {
      const hit = (s.artist + " " + s.title).toLowerCase().includes(q);
      if (!hit) return false;

      if (m !== "all" && m !== "Any" && s.mood !== m) return false;
      if (g !== "all" && g !== "Any" && s.genre !== g) return false;

      if (f === "all") return true;
      if (f === "fav") return s.fav === "fav";
      if (f === "xfav") return s.fav === "xfav";
      if (f === "any") return s.fav === "fav" || s.fav === "xfav";
      if (f === "none") return s.fav === "none";
      return true;
    });
  }

  // ---------- UI Elements ----------
  const artistInput = document.getElementById("artistInput");
  const songInput = document.getElementById("songInput");
  const moodSelect = document.getElementById("moodSelect");
  const genreSelect = document.getElementById("genreSelect");
  const favSelect = document.getElementById("favSelect");

  const addBtn = document.getElementById("addBtn");

  const searchInput = document.getElementById("searchInput");
  const filterMood = document.getElementById("filterMood");
  const filterGenre = document.getElementById("filterGenre");
  const filterFav = document.getElementById("filterFav");

  const statArtists = document.getElementById("statArtists");
  const statSongs = document.getElementById("statSongs");

  const exportBtn = document.getElementById("exportBtn");
  const importBtn = document.getElementById("importBtn");
  const fileInput = document.getElementById("fileInput");
  const clearBtn = document.getElementById("clearBtn");

  const listEl = document.getElementById("list");

  // ---------- Init Selects ----------
  buildSelect(moodSelect, MOODS);
  buildSelect(genreSelect, GENRES);

  // Filter selects (All + list)
  buildSelect(filterMood, MOODS, true);
  buildSelect(filterGenre, GENRES, true);

  filterMood.value = "all";
  filterGenre.value = "all";
  filterFav.value = "all";
  moodSelect.value = "Any";
  genreSelect.value = "Any";
  favSelect.value = "none";

  // ---------- Render ----------
  function render() {
    const db = loadDB();
    const filtered = getFilteredSongs(db.songs);

    // Stats: unique artists (based on ALL songs, not filtered)
    const allSorted = sortDBSongs(db.songs);
    const artistsSet = new Set(allSorted.map(s => s.artist));
    statArtists.textContent = `Artists: ${artistsSet.size}`;
    statSongs.textContent = `Songs: ${allSorted.length}`;

    // Build grouped by artist for filtered set
    const byArtist = new Map();
    filtered.forEach(s => {
      if (!byArtist.has(s.artist)) byArtist.set(s.artist, []);
      byArtist.get(s.artist).push(s);
    });

    // Artist numbering (based on FULL A-Z artist list, so stable)
    const artistListAll = Array.from(new Set(allSorted.map(s => s.artist))).sort(cmpAZ);
    const artistNumber = new Map(artistListAll.map((a, i) => [a, i+1]));

    // Global song numbering (based on FULL sorted list)
    const globalSongIndex = new Map(allSorted.map((s, i) => [s.id, i+1]));

    // Render
    listEl.innerHTML = "";

    if (filtered.length === 0) {
      const empty = document.createElement("div");
      empty.className = "card";
      empty.innerHTML = `<p class="sub" style="margin:0;">No results. Add a song above, or clear filters.</p>`;
      listEl.appendChild(empty);
      return;
    }

    // For each artist in filtered (A-Z)
    Array.from(byArtist.keys()).sort(cmpAZ).forEach(artist => {
      const songs = byArtist.get(artist);
      // Songs already sorted globally; but ensure within group:
      songs.sort((x,y)=>cmpAZ(x.title,y.title));

      const artistCard = document.createElement("div");
      artistCard.className = "artistCard";

      const head = document.createElement("div");
      head.className = "artistHead";

      const title = document.createElement("div");
      title.className = "artistTitle";
      const aNo = artistNumber.get(artist) || 0;
      title.innerHTML = `<strong>${aNo}. ${escapeHtml(artist)}</strong><span>${songs.length} song(s) in this view</span>`;

      head.appendChild(title);
      artistCard.appendChild(head);

      const songList = document.createElement("div");
      songList.className = "songList";

      songs.forEach((s, idxInArtist) => {
        const row = document.createElement("div");
        row.className = "songRow";

        const main = document.createElement("div");
        main.className = "songMain";

        const globalNo = globalSongIndex.get(s.id) || "?";
        const withinArtistNo = idxInArtist + 1;

        const favBadge = (s.fav === "fav") ? "★" : (s.fav === "xfav" ? "★★" : "");
        main.innerHTML = `
          <div class="songTitle">${globalNo}. ${withinArtistNo}) ${escapeHtml(s.title)} ${favBadge}</div>
          <div class="songMeta">
            ${s.mood && s.mood !== "Any" ? `<span class="tag">Mood: ${escapeHtml(s.mood)}</span>` : ""}
            ${s.genre && s.genre !== "Any" ? `<span class="tag">Genre: ${escapeHtml(s.genre)}</span>` : ""}
          </div>
        `;

        const actions = document.createElement("div");
        actions.className = "actions";

        const btnFav = document.createElement("button");
        btnFav.className = "iconBtn" + (s.fav === "fav" ? " on" : "");
        btnFav.textContent = "★";
        btnFav.title = "Toggle Favorite";
        btnFav.onclick = () => toggleFav(s.id, "fav");

        const btnXFav = document.createElement("button");
        btnXFav.className = "iconBtn" + (s.fav === "xfav" ? " on" : "");
        btnXFav.textContent = "★★";
        btnXFav.title = "Toggle Extra Favorite";
        btnXFav.onclick = () => toggleFav(s.id, "xfav");

        const btnEdit = document.createElement("button");
        btnEdit.className = "iconBtn";
        btnEdit.textContent = "Edit";
        btnEdit.onclick = () => editSong(s.id);

        const btnDel = document.createElement("button");
        btnDel.className = "iconBtn danger";
        btnDel.textContent = "Del";
        btnDel.onclick = () => deleteSong(s.id);

        actions.appendChild(btnFav);
        actions.appendChild(btnXFav);
        actions.appendChild(btnEdit);
        actions.appendChild(btnDel);

        row.appendChild(main);
        row.appendChild(actions);
        songList.appendChild(row);
      });

      artistCard.appendChild(songList);
      listEl.appendChild(artistCard);
    });
  }

  // ---------- Actions ----------
  function addSong() {
    const artist = norm(artistInput.value);
    const title = norm(songInput.value);
    if (!artist || !title) {
      alert("Vul Artist én Song title in.");
      return;
    }
    const db = loadDB();

    // Prevent duplicates (same artist + title)
    const exists = db.songs.some(s =>
      s.artist.toLowerCase() === artist.toLowerCase() &&
      s.title.toLowerCase() === title.toLowerCase()
    );
    if (exists) {
      alert("Deze song staat al in je lijst (zelfde artist + titel).");
      return;
    }

    db.songs.push({
      id: uid(),
      artist,
      title,
      mood: moodSelect.value || "Any",
      genre: genreSelect.value || "Any",
      fav: favSelect.value || "none",
      createdAt: Date.now()
    });
    saveDB(db);

    // Quick reset for mobile speed
    songInput.value = "";
    favSelect.value = "none";
    songInput.focus();

    render();
  }

  function toggleFav(id, mode) {
    const db = loadDB();
    const s = db.songs.find(x => x.id === id);
    if (!s) return;

    // toggle logic: clicking same mode removes it; clicking other sets it
    if (s.fav === mode) s.fav = "none";
    else s.fav = mode;

    saveDB(db);
    render();
  }

  function editSong(id) {
    const db = loadDB();
    const s = db.songs.find(x => x.id === id);
    if (!s) return;

    const newArtist = prompt("Artist:", s.artist);
    if (newArtist === null) return;
    const newTitle = prompt("Song title:", s.title);
    if (newTitle === null) return;

    s.artist = norm(newArtist) || s.artist;
    s.title = norm(newTitle) || s.title;

    // Mood / genre quick edit via confirm-like prompts (simple & mobile-friendly)
    const changeMood = confirm("Mood aanpassen? (OK = ja)");
    if (changeMood) {
      const m = prompt("Mood options: " + MOODS.filter(x=>x!=="Any").join(", "), s.mood || "Any");
      if (m !== null && MOODS.includes(m)) s.mood = m;
    }
    const changeGenre = confirm("Genre aanpassen? (OK = ja)");
    if (changeGenre) {
      const g = prompt("Genre options: " + GENRES.filter(x=>x!=="Any").join(", "), s.genre || "Any");
      if (g !== null && GENRES.includes(g)) s.genre = g;
    }

    saveDB(db);
    render();
  }

  function deleteSong(id) {
    if (!confirm("Delete this song?")) return;
    const db = loadDB();
    db.songs = db.songs.filter(x => x.id !== id);
    saveDB(db);
    render();
  }

  // ---------- Export / Import ----------
  function exportJSON() {
    const db = loadDB();
    const data = {
      version: 1,
      exportedAt: new Date().toISOString(),
      ...db
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "my-songs-export.json";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  function importJSONFile(file) {
    const reader = new FileReader();
    reader.onload = () => {
      try {
        const imported = JSON.parse(reader.result);
        if (!imported || !Array.isArray(imported.songs)) {
          alert("Dit bestand lijkt geen geldige export.");
          return;
        }

        // Merge by id (or by artist+title if id missing)
        const db = loadDB();
        const existingById = new Map(db.songs.map(s => [s.id, s]));
        const existingByKey = new Set(db.songs.map(s => (s.artist+"||"+s.title).toLowerCase()));

        imported.songs.forEach(s => {
          // sanitize
          const clean = {
            id: s.id || uid(),
            artist: norm(s.artist),
            title: norm(s.title),
            mood: MOODS.includes(s.mood) ? s.mood : "Any",
            genre: GENRES.includes(s.genre) ? s.genre : "Any",
            fav: (s.fav === "fav" || s.fav === "xfav") ? s.fav : "none",
            createdAt: typeof s.createdAt === "number" ? s.createdAt : Date.now()
          };
          if (!clean.artist || !clean.title) return;

          const key = (clean.artist+"||"+clean.title).toLowerCase();
          if (existingById.has(clean.id)) {
            // update existing
            Object.assign(existingById.get(clean.id), clean);
          } else if (!existingByKey.has(key)) {
            db.songs.push(clean);
            existingByKey.add(key);
          }
        });

        saveDB(db);
        alert("Import complete!");
        render();
      } catch {
        alert("Kon JSON niet lezen. Is dit wel een JSON export?");
      }
    };
    reader.readAsText(file);
  }

  function clearAll() {
    if (!confirm("Alles wissen op dit device (local)?")) return;
    localStorage.removeItem(STORAGE_KEY);
    render();
  }

  function escapeHtml(s) {
    return (s || "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  // ---------- Events ----------
  addBtn.addEventListener("click", addSong);
  [searchInput, filterMood, filterGenre, filterFav].forEach(el => el.addEventListener("input", render));
  [artistInput, songInput].forEach(el => el.addEventListener("keydown", (e) => {
    if (e.key === "Enter") addSong();
  }));

  exportBtn.addEventListener("click", exportJSON);
  importBtn.addEventListener("click", () => fileInput.click());
  fileInput.addEventListener("change", (e) => {
    const f = e.target.files && e.target.files[0];
    if (f) importJSONFile(f);
    fileInput.value = "";
  });
  clearBtn.addEventListener("click", clearAll);

  // ---------- First render ----------
  render();
</script>
</body>
</html>

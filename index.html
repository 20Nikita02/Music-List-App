<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Music List</title>
  <style>
    :root { --bg:#0b0c10; --card:#12141a; --muted:#a7adbb; --text:#eef1f7; --line:#222634; --accent:#7aa2ff; }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg); color: var(--text);
    }
    header {
      position: sticky; top: 0; z-index: 10;
      background: linear-gradient(180deg, rgba(11,12,16,.98), rgba(11,12,16,.88));
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--line);
      padding: 14px 14px 10px;
    }
    h1 { margin: 0 0 8px; font-size: 18px; letter-spacing: .2px; }
    .row { display: flex; gap: 10px; }
    input, select, button {
      border: 1px solid var(--line);
      background: var(--card);
      color: var(--text);
      padding: 10px 10px;
      border-radius: 12px;
      font-size: 14px;
      outline: none;
    }
    input::placeholder { color: #7f8796; }
    button { cursor: pointer; }
    button.primary { background: #1a2240; border-color: #2a3a7a; }
    button.ghost { background: transparent; }
    .wrap { padding: 12px 14px 40px; }
    .controls { display: grid; gap: 10px; }
    .controls .row { align-items: center; }
    .row > * { flex: 1; }
    .row .small { flex: 0 0 auto; }
    .stats {
      display: grid; grid-template-columns: 1fr 1fr;
      gap: 10px; margin: 10px 0 0;
    }
    .pill {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 10px 12px;
      font-size: 12px;
      color: var(--muted);
    }
    .pill b { color: var(--text); font-size: 14px; }
    .list { margin-top: 12px; display: grid; gap: 10px; }
    details {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 16px;
      overflow: hidden;
    }
    summary {
      list-style: none;
      padding: 12px 12px;
      display: flex; align-items: center; gap: 10px;
      cursor: pointer;
    }
    summary::-webkit-details-marker { display:none; }
    .artistNo {
      flex: 0 0 auto;
      width: 34px; height: 34px;
      border-radius: 12px;
      background: #171b26;
      border: 1px solid var(--line);
      display: grid; place-items: center;
      font-weight: 700; color: var(--accent);
    }
    .artistMeta { display:flex; flex-direction: column; gap: 2px; min-width: 0; }
    .artistName { font-weight: 700; font-size: 15px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .artistCount { font-size: 12px; color: var(--muted); }
    .songs { border-top: 1px solid var(--line); padding: 6px 8px 10px; display: grid; gap: 6px; }
    .songRow {
      display: grid;
      grid-template-columns: 44px 1fr auto;
      gap: 10px;
      align-items: center;
      padding: 8px 8px;
      border-radius: 12px;
    }
    .songRow:hover { background: rgba(255,255,255,.03); }
    .songNums {
      font-size: 11px; color: var(--muted);
      line-height: 1.15;
    }
    .songNums b { color: var(--text); font-size: 12px; }
    .songTitle { font-size: 14px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .tags { display: flex; gap: 6px; align-items:center; }
    .tag {
      font-size: 11px; color: var(--muted);
      border: 1px solid var(--line);
      padding: 5px 8px;
      border-radius: 999px;
    }
    .tag.fav { color: #ffd58a; border-color: #3a2f1a; background: rgba(255,213,138,.06); }
    .actions { display:flex; gap: 6px; }
    .iconBtn {
      width: 36px; height: 36px;
      border-radius: 12px;
      display:grid; place-items:center;
      background: transparent;
      border: 1px solid var(--line);
    }
    .footerRow { display:flex; gap: 8px; flex-wrap: wrap; margin-top: 10px; }
    .hint { color: var(--muted); font-size: 12px; margin-top: 8px; line-height: 1.35; }
    .danger { border-color:#4a2430; background: rgba(255,120,150,.06); }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
  </style>
</head>
<body>
  <header>
    <h1>My Music List</h1>

    <div class="controls">
      <div class="row">
        <input id="artistInput" placeholder="Artist (e.g. Radiohead)" autocomplete="off" />
        <input id="titleInput" placeholder="Song title (e.g. Karma Police)" autocomplete="off" />
      </div>
      <div class="row">
        <input id="moodInput" placeholder="Mood (optional: chill / gym / sad)" autocomplete="off" />
        <button id="addBtn" class="primary small">Add</button>
      </div>

      <div class="row">
        <input id="searchInput" placeholder="Search artist or song‚Ä¶" autocomplete="off" />
        <select id="filterSelect" class="small">
          <option value="all">All</option>
          <option value="fav">Favorites only</option>
        </select>
      </div>

      <div class="stats">
        <div class="pill"><div>Total songs</div><b id="totalSongs">0</b></div>
        <div class="pill"><div>Total artists</div><b id="totalArtists">0</b></div>
      </div>

      <div class="footerRow">
        <button id="exportBtn" class="ghost">Export</button>
        <label class="ghost" style="display:inline-flex; align-items:center; gap:8px; padding:10px 10px; border-radius:12px; border:1px solid var(--line); cursor:pointer;">
          Import
          <input id="importFile" type="file" accept="application/json" style="display:none;">
        </label>
        <button id="clearBtn" class="ghost danger">Clear all</button>
      </div>

      <div class="hint">
        ‚Ä¢ Everything is <b>A‚ÄìZ</b>. ‚Ä¢ Numbering shows <span class="mono">Artist #</span>, <span class="mono">Song # (global)</span>, and <span class="mono">Song # within artist</span>.<br/>
        ‚Ä¢ Tap ‚≠ê to favorite. ‚Ä¢ Tap ‚úèÔ∏è to edit. ‚Ä¢ Tap üóëÔ∏è to delete.
      </div>
    </div>
  </header>

  <div class="wrap">
    <div id="list" class="list"></div>
  </div>

<script>
  const KEY = "my_music_list_v1";

  /** @typedef {{id:string, artist:string, title:string, fav:boolean, mood?:string, createdAt:number}} Song */

  const $ = (id) => document.getElementById(id);

  const state = {
    /** @type {Song[]} */
    songs: []
  };

  function uid() {
    return Math.random().toString(16).slice(2) + "-" + Date.now().toString(16);
  }

  function normalize(s) { return (s || "").trim(); }
  function sortAZ(a, b) {
    return a.localeCompare(b, undefined, { sensitivity: "base" });
  }

  function save() {
    localStorage.setItem(KEY, JSON.stringify(state.songs));
  }

  function load() {
    const raw = localStorage.getItem(KEY);
    state.songs = raw ? JSON.parse(raw) : [];
  }

  function getFilteredSongs() {
    const q = normalize($("searchInput").value).toLowerCase();
    const filter = $("filterSelect").value;

    return state.songs
      .filter(s => {
        if (filter === "fav" && !s.fav) return false;
        if (!q) return true;
        return (s.artist + " " + s.title + " " + (s.mood||"")).toLowerCase().includes(q);
      })
      .slice()
      .sort((x, y) => sortAZ(x.artist, y.artist) || sortAZ(x.title, y.title));
  }

  function computeArtistOrder(songsSorted) {
    const artists = [];
    const seen = new Set();
    for (const s of songsSorted) {
      const a = s.artist;
      if (!seen.has(a)) { seen.add(a); artists.push(a); }
    }
    return artists; // already A-Z because songsSorted is A-Z
  }

  function groupByArtist(songsSorted) {
    /** @type {Record<string, Song[]>} */
    const groups = {};
    for (const s of songsSorted) {
      (groups[s.artist] ||= []).push(s);
    }
    // ensure songs within artist sorted A-Z by title
    for (const a of Object.keys(groups)) {
      groups[a].sort((x, y) => sortAZ(x.title, y.title));
    }
    return groups;
  }

  function setStats(songsSorted) {
    $("totalSongs").textContent = String(state.songs.length);
    const artistsSet = new Set(state.songs.map(s => s.artist));
    $("totalArtists").textContent = String(artistsSet.size);
  }

  function render() {
    const songsSorted = getFilteredSongs();
    setStats(songsSorted);

    const list = $("list");
    list.innerHTML = "";

    const artistOrder = computeArtistOrder(songsSorted);
    const groups = groupByArtist(songsSorted);

    // Global song numbering over ALL artists (based on current sort + filters)
    // If you want "global numbering of all songs ever", use state.songs sorted A-Z instead.
    const globalIndex = new Map();
    songsSorted.forEach((s, i) => globalIndex.set(s.id, i + 1));

    artistOrder.forEach((artist, ai) => {
      const artistNo = ai + 1;
      const songs = groups[artist] || [];

      const details = document.createElement("details");
      details.open = true;

      const summary = document.createElement("summary");
      summary.innerHTML = `
        <div class="artistNo">${artistNo}</div>
        <div class="artistMeta">
          <div class="artistName">${escapeHtml(artist)}</div>
          <div class="artistCount">${songs.length} song${songs.length === 1 ? "" : "s"}</div>
        </div>
      `;

      const songsDiv = document.createElement("div");
      songsDiv.className = "songs";

      songs.forEach((song, si) => {
        const withinArtistNo = si + 1;
        const globalNo = globalIndex.get(song.id) || 0;

        const row = document.createElement("div");
        row.className = "songRow";
        row.innerHTML = `
          <div class="songNums">
            <div><b>#${globalNo}</b> all</div>
            <div>#${withinArtistNo} artist</div>
          </div>

          <div style="min-width:0;">
            <div class="songTitle">${escapeHtml(song.title)}</div>
            <div class="tags">
              ${song.fav ? `<span class="tag fav">‚≠ê favorite</span>` : ``}
              ${song.mood ? `<span class="tag">${escapeHtml(song.mood)}</span>` : ``}
            </div>
          </div>

          <div class="actions">
            <button class="iconBtn" title="Favorite" aria-label="Favorite">${song.fav ? "‚≠ê" : "‚òÜ"}</button>
            <button class="iconBtn" title="Edit" aria-label="Edit">‚úèÔ∏è</button>
            <button class="iconBtn" title="Delete" aria-label="Delete">üóëÔ∏è</button>
          </div>
        `;

        const [favBtn, editBtn, delBtn] = row.querySelectorAll("button");

        favBtn.addEventListener("click", (e) => {
          e.preventDefault();
          song.fav = !song.fav;
          save(); render();
        });

        editBtn.addEventListener("click", (e) => {
          e.preventDefault();
          const newArtist = prompt("Artist:", song.artist);
          if (newArtist === null) return;
          const newTitle = prompt("Song title:", song.title);
          if (newTitle === null) return;
          const newMood = prompt("Mood (optional):", song.mood || "");
          song.artist = normalize(newArtist) || song.artist;
          song.title  = normalize(newTitle)  || song.title;
          song.mood   = normalize(newMood);
          save(); render();
        });

        delBtn.addEventListener("click", (e) => {
          e.preventDefault();
          if (!confirm(`Delete: ${song.artist} ‚Äì ${song.title}?`)) return;
          state.songs = state.songs.filter(x => x.id !== song.id);
          save(); render();
        });

        songsDiv.appendChild(row);
      });

      details.appendChild(summary);
      details.appendChild(songsDiv);
      list.appendChild(details);
    });

    if (artistOrder.length === 0) {
      const empty = document.createElement("div");
      empty.className = "pill";
      empty.textContent = "No results. Add your first song above.";
      list.appendChild(empty);
    }
  }

  function addSong() {
    const artist = normalize($("artistInput").value);
    const title = normalize($("titleInput").value);
    const mood = normalize($("moodInput").value);

    if (!artist || !title) {
      alert("Please enter both Artist and Song title.");
      return;
    }

    state.songs.push({
      id: uid(),
      artist,
      title,
      fav: false,
      mood: mood || "",
      createdAt: Date.now()
    });

    $("titleInput").value = "";
    $("moodInput").value = "";
    $("titleInput").focus();

    save();
    render();
  }

  function exportData() {
    const blob = new Blob([JSON.stringify(state.songs, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "my-music-list-backup.json";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  function importData(file) {
    const reader = new FileReader();
    reader.onload = () => {
      try {
        const data = JSON.parse(String(reader.result));
        if (!Array.isArray(data)) throw new Error("Not an array");
        // Light validation
        const cleaned = data
          .filter(x => x && typeof x.artist === "string" && typeof x.title === "string")
          .map(x => ({
            id: typeof x.id === "string" ? x.id : uid(),
            artist: normalize(x.artist) || "Unknown",
            title: normalize(x.title) || "Untitled",
            fav: !!x.fav,
            mood: typeof x.mood === "string" ? normalize(x.mood) : "",
            createdAt: typeof x.createdAt === "number" ? x.createdAt : Date.now()
          }));

        state.songs = cleaned;
        save();
        render();
        alert("Import complete ‚úÖ");
      } catch (e) {
        alert("Import failed. Please choose a valid JSON backup file.");
      }
    };
    reader.readAsText(file);
  }

  function clearAll() {
    if (!confirm("This will delete EVERYTHING on this device. Continue?")) return;
    state.songs = [];
    save();
    render();
  }

  function escapeHtml(str) {
    return String(str)
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;");
  }

  // Wire up UI
  $("addBtn").addEventListener("click", addSong);
  $("titleInput").addEventListener("keydown", (e) => { if (e.key === "Enter") addSong(); });
  $("artistInput").addEventListener("keydown", (e) => { if (e.key === "Enter") $("titleInput").focus(); });

  $("searchInput").addEventListener("input", render);
  $("filterSelect").addEventListener("change", render);

  $("exportBtn").addEventListener("click", exportData);
  $("importFile").addEventListener("change", (e) => {
    const file = e.target.files && e.target.files[0];
    if (file) importData(file);
    e.target.value = ""; // reset
  });

  $("clearBtn").addEventListener("click", clearAll);

  // Start
  load();
  render();
</script>
</body>
</html>
